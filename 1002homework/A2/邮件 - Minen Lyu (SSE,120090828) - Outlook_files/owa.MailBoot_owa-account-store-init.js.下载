self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~owa-account-store-init.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[899],{1881:function(e,n,t){"use strict";t.r(n);var r=t(1),o=t(57),c=t(1086),u=t(374),i=t(1986),s=t(209),a=t(3237),d=t(419);var b={};function l(e,n){return Object(r.c)(this,void 0,void 0,(function(){var t,l,f,O;return Object(r.f)(this,(function(v){return t=e.userIdentity,l=Object(o.i)(t),f=b[t],l&&!f?[2,Promise.resolve()]:f?[2,f.requestPromise]:(O=function(e,n){return Object(r.c)(this,void 0,void 0,(function(){var t,b,l,f,O,v,j,p,S;return Object(r.f)(this,(function(r){switch(r.label){case 0:t=e.userIdentity,b=e.accountProviderType,r.label=1;case 1:return r.trys.push([1,6,,7]),Object(u.d)(e),l=Object(s.d)(t),[4,Object(i.b)(Object(d.a)(l))];case 2:return f=r.sent(),O=Object(u.s)(t),f.headers&&O?[4,Object(a.a)(f)]:[3,4];case 3:return v=r.sent(),Object(o.y)(v,t),Object(c.c)(t,b),[3,5];case 4:j=f.headers?"Account invalid ":"Missing headers",Object(c.b)(t,n,b,j),r.label=5;case 5:return[3,7];case 6:return p=r.sent(),S="Exception"+p,Object(c.b)(t,n,b,S),[3,7];case 7:return[2]}}))}))}(e,n),b[t]={requestPromise:O},[2,O])}))}))}var f=t(3067),O=t(2),v=t(94),j=t(24),p=t(5),S=t(121);function A(e){return e<=0?{lowerBoundSeconds:null,upperBoundSeconds:0}:e<=30?{lowerBoundSeconds:0,upperBoundSeconds:30}:e<=60?{lowerBoundSeconds:30,upperBoundSeconds:60}:e<=300?{lowerBoundSeconds:60,upperBoundSeconds:300}:e<=600?{lowerBoundSeconds:300,upperBoundSeconds:600}:e<=1800?{lowerBoundSeconds:600,upperBoundSeconds:1800}:e<=3600?{lowerBoundSeconds:1800,upperBoundSeconds:3600}:e<=21600?{lowerBoundSeconds:3600,upperBoundSeconds:21600}:e<=43200?{lowerBoundSeconds:21600,upperBoundSeconds:43200}:e<=86400?{lowerBoundSeconds:43200,upperBoundSeconds:86400}:e>86400?{lowerBoundSeconds:86400,upperBoundSeconds:null}:{lowerBoundSeconds:null,upperBoundSeconds:null}}function w(e){switch(e.providerType){case f.c.Msa:case f.c.MsaInt:return!0;case f.c.Google:return Object(j.i)("cal-addCalendar-google");case f.c.TeamSnap:return!1;case f.c.ICloud:return Object(j.i)("cal-addCalendar-iCloud");default:return Object(v.a)(e.providerType)}}Object(O.orchestrator)(c.a,(function(){return Object(r.c)(void 0,void 0,void 0,(function(){var e,n,t,o;return Object(r.f)(this,(function(c){switch(c.label){case 0:return(e=Object(u.h)())==u.a.AccountsLoadSuccessful||e==u.a.Loading?[2]:(Object(u.w)(u.a.Loading),[4,f.e.importAndExecute()]);case 1:return n=c.sent(),t=n,o=null==n?void 0:n.isSuccess,t.ConnectedAccountResponses&&"function"==typeof t.ConnectedAccountResponses.filter?[4,Promise.all(t.ConnectedAccountResponses.filter(w).map((function(e){return Object(r.c)(void 0,void 0,void 0,(function(){var n,t;return Object(r.f)(this,(function(r){switch(r.label){case 0:return n=function(e){switch(e){case f.c.Msa:return"Outlook";case f.c.Google:return"Google";case f.c.ICloud:return"ICloud";default:return Object(v.a)(e)}}(e.providerType),t=parseInt(e.token.expiresIn),Object(S.s)("hasConnectedAccount",{tokenExpiry:t,type_1:n,tokenExpiryLowerBound_3:A(t).lowerBoundSeconds,tokenExpirtyUpperBound_4:A(t).upperBoundSeconds},{isCore:!0}),[4,l({userIdentity:e.userAccount.emailAddress,accountId:e.userAccount.id,accountUniqueId:e.userAccount.accountUniqueId,anchorMailbox:e.userAccount.routingHint,token:e.token.accessToken,tokenExpiry:Object(p.j)(Object(p.Rb)(),t),accountProviderType:n,accountState:u.b.Valid},!1)];case 1:return r.sent(),Object(u.l)(e.userAccount.emailAddress)!=u.b.Valid&&(o=!1),[2]}}))}))})))]:[3,3];case 2:c.sent(),c.label=3;case 3:return Object(u.e)(o),[2]}}))}))})),Object(O.orchestrator)(c.d,(function(e){var n=e.userIdentity;Object(u.u)(n),Object(o.x)(n),Object(s.f)(n),function(e){delete b[e]}(n)}));var h=t(2051);Object(O.orchestrator)(h.b,(function(e){l(Object(u.k)(e.userIdentity),!0)})),Object(O.orchestrator)(c.b,(function(e){var n=e.userIdentity,t=e.isRetry,r=e.accountProvider,o=e.error;(Object(S.s)("owaAccountStoreInitializationFailed",{error:o,accountProvider:r,isRetry:t},{isCore:!0}),t)?Object(u.x)(n,u.b.FailedToInitializeOWAConfig):l(Object(u.k)(n),!0)})),t.d(n,"initializeOwaAccountsStore",(function(){return c.a})),t.d(n,"removeOWAConnectedAccount",(function(){return c.d})),t.d(n,"owaAccountStoreInitializationFailed",(function(){return c.b})),t.d(n,"initializeOwaConnectedAccount",(function(){return l}))},1986:function(e,n,t){"use strict";var r=t(1),o=t(2051),c=t(374),u=t(730),i=t(121),s=t(5),a="X-AnchorMailbox",d="Authorization",b="X-OwaWebSessionType",l="X-OWA-ExplicitLogonUser";function f(e,n){return Object(r.c)(this,void 0,void 0,(function(){var t,f,O,v,j;return Object(r.f)(this,(function(r){switch(r.label){case 0:if(t={},f=Object(c.k)(e)){if(f.accountState==c.b.AccessRevoked)return[2,null];if(f.accountState==c.b.AccountDeprovisioned||f.accountState==c.b.AccountNotFound)return Object(c.c)(f.accountState,f.accountProviderType),[2,null]}return n?(t[a]=n,t[l]=n):f&&(t[a]=f.anchorMailbox),f?(O=f.token,!(v=Object(u.g)(f.tokenExpiry))&&O?[3,2]:(Object(i.s)("getAndUpdateAccessToken",{tokenExpiry:Object(s.y)(f.tokenExpiry,Object(s.Rb)()),isTokenExpired_1:v,isTokenInvalid_2:!O},{isCore:!0}),[4,o.a.importAndExecute(f.accountId,e,O)])):[3,3];case 1:(O=r.sent())||(O=""),r.label=2;case 2:j=void 0,"Outlook"==f.accountProviderType?(j='MSAuth1.0 usertoken="'+O+'", type="MSACT"',t[b]=1..toString()):"Google"!=f.accountProviderType&&"ICloud"!=f.accountProviderType||(j="Bearer "+O,t[b]=2..toString()),t[d]=j,r.label=3;case 3:return[2,t]}}))}))}var O=t(1989),v=t(23);function j(e,n){return Object(r.c)(this,void 0,void 0,(function(){var t,o;return Object(r.f)(this,(function(r){switch(r.label){case 0:return t=Object(O.a)(),o=t,[4,p(e,n)];case 1:return o.headers=r.sent(),t.authNeededOnUnAuthorized=!1,t.datapoint=t.datapoint||{},t.datapoint.mailbox="Connected",[2,t]}}))}))}function p(e,n){var t;return Object(r.c)(this,void 0,void 0,(function(){var o,c;return Object(r.f)(this,(function(r){switch(r.label){case 0:return o=n&&(null===(t=e.headers)||void 0===t?void 0:t.set)?new Headers(e.headers):new Headers,[4,f(e.mailboxInfo.userIdentity,S(e.mailboxInfo.type,e.mailboxInfo.mailboxSmtpAddress)?e.mailboxInfo.mailboxSmtpAddress:null)];case 1:return c=r.sent(),Object(O.b)(o,c),[2,o]}}))}))}function S(e,n){var t="GroupMailbox"==e||"TeamsMailbox"==e||"SharedMailbox"==e||"PublicMailbox"==e;return t&&null==n&&v.d("getHeadersForConnectedAccount: mailboxSmtpAddress should be passed for Group or Teams or Shared or Public Mbx request"),t}t.d(n,"a",(function(){return f})),t.d(n,"b",(function(){return j})),t.d(n,"c",(function(){return S}))},1989:function(e,n,t){"use strict";function r(e,n){Object.keys(n).forEach((function(t){return e.set(t,n[t])}))}function o(e){var n=null!=e?e:{headers:new Headers};return n.datapoint=n.datapoint||{},n.datapoint.mailbox="Default",n}t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return o}))},1991:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(2),o=Object(r.action)("triggerReInitializeAccount",(function(e){return{userIdentity:e}}))},2051:function(e,n,t){"use strict";t.d(n,"a",(function(){return u}));var r=t(31),o=t(1991);t.d(n,"b",(function(){return o.a}));var c=new r.c((function(){return t.e(1286).then(t.bind(null,2298))})),u=new r.a(c,(function(e){return e.getAndUpdateAccessToken}))},209:function(e,n,t){"use strict";var r=t(19),o=t(575),c=t(24),u=t(23);function i(){var e=Object(r.a)();if(!e||!e.SessionSettings)return u.d("SessionSettings not available"),"no-mailbox-id";var n=e.SessionSettings.UserEmailAddress;return Object(c.i)("doc-attachment-usePrimarySmtpAddressForMailboxId")?n:(e.SessionSettings.IsShadowMailbox?n=e.SessionSettings.LogonEmailAddress:Object(o.c)(e.HexCID,e.SessionSettings.UserEmailAddress)&&(n=Object(o.b)(e.HexCID,e.SessionSettings.NotManagedEmailAddresses,e.SessionSettings.UserProxyAddresses)),n)}var s=t(868),a=t(638);function d(e){var n=Object(a.a)().userMailboxInfoMap;n&&n.delete(e)}function b(e,n){return e===n||null!=e&&null!=n&&e.Id===n.Id}var l=t(476);t.d(n,"c",(function(){return i})),t.d(n,"d",(function(){return s.a})),t.d(n,"f",(function(){return d})),t.d(n,"e",(function(){return b})),t.d(n,"a",(function(){return o.a})),t.d(n,"b",(function(){return l.a}))},217:function(e,n,t){"use strict";var r=t(859);t.d(n,"a",(function(){return r.a}))},2801:function(e,n,t){"use strict";var r;t.d(n,"a",(function(){return r})),function(e){e[e.AccessRevoked=0]="AccessRevoked",e[e.AccountNotFound=1]="AccountNotFound",e[e.InvalidClient=2]="InvalidClient",e[e.InvalidCredentials=3]="InvalidCredentials",e[e.InvalidProvider=4]="InvalidProvider",e[e.MailboxDeprovisioned=5]="MailboxDeprovisioned",e[e.Transient=6]="Transient",e[e.PermissionDenied=7]="PermissionDenied",e[e.UserCancelled=8]="UserCancelled",e[e.AadAuth=9]="AadAuth",e[e.Unknown=10]="Unknown",e[e.ProviderUnavailable=11]="ProviderUnavailable",e[e.TooManyRequests=12]="TooManyRequests"}(r||(r={}))},3067:function(e,n,t){"use strict";var r=t(31),o=t(3166),c=t(2801),u=t(3959);function i(e){return Object(u.a)(e)}t.d(n,"g",(function(){return a})),t.d(n,"e",(function(){return d})),t.d(n,"h",(function(){return b})),t.d(n,"f",(function(){return l})),t.d(n,"i",(function(){return f})),t.d(n,"c",(function(){return o.b})),t.d(n,"a",(function(){return o.a})),t.d(n,"b",(function(){return c.a})),t.d(n,"d",(function(){return i}));var s=new r.c((function(){return Promise.all([t.e(0),t.e(1),t.e(2),t.e(3),t.e(5),t.e(10),t.e(21),t.e(22),t.e(46),t.e(900)]).then(t.bind(null,18260))})),a=new r.a(s,(function(e){return e.linkAccountAndGetAccessToken})),d=new r.a(s,(function(e){return e.getAllConnectedAccounts})),b=(new r.a(s,(function(e){return e.getConnectedAccount})),new r.a(s,(function(e){return e.addConnectedAccount})),new r.a(s,(function(e){return e.removeConnectedAccount}))),l=(new r.a(s,(function(e){return e.refreshConnectedAccountAccessToken})),new r.a(s,(function(e){return e.idpResponseHandler}))),f=new r.a(s,(function(e){return e.setAddConnectedAccountHandler}));"undefined"!=typeof window&&void 0!==window.Owa&&(window.Owa.lazyIdpResponseHandler=l)},3166:function(e,n,t){"use strict";var r,o;t.d(n,"b",(function(){return r})),t.d(n,"a",(function(){return o})),function(e){e.Msa="Msa",e.TeamSnap="TeamSnap",e.MsaInt="MsaInt",e.Google="Google",e.ICloud="ICloud"}(r||(r={})),function(e){e.Active="Active",e.Revoked="Revoked",e.Error="Error"}(o||(o={}))},3237:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));var r=t(33);function o(e){return Object(r.a)("GetOwaUserConfiguration",{},e)}},3959:function(e,n,t){"use strict";t.d(n,"a",(function(){return d}));var r=t(1),o=t(6),c=t(151),u=t(2801),i=t(217),s=t(3960),a="ows/beta/ConnectedAccounts/refreshtoken/{0}";function d(e){var n=this;return Object(c.d)(Object(o.c)(a,e),null,void 0,!0).then((function(e){return Object(r.c)(n,void 0,void 0,(function(){var n,t,o;return Object(r.f)(this,(function(r){switch(r.label){case 0:return[4,e.json()];case 1:return n=r.sent(),t=n,Object(s.a)("refreshToken_serviceResponse",e,t),Object(i.a)(e.status)?[2,{ConnectedAccountResponse:n,isSuccess:!0}]:400==e.status||404==e.status?[2,{errorResponse:n,isSuccess:!1}]:429==e.status?(o=Number(e.headers.get("RetryAfter").slice(-2)),Object(s.b)(o,"refreshAccountToken"),[2,{errorResponse:{error:u.a[u.a.TooManyRequests]},isSuccess:!1,retryAfter:o}]):[2,{errorResponse:{error:u.a[u.a.Transient]},isSuccess:!1}]}}))}))})).catch((function(e){return{errorResponse:{error:u.a[u.a.Unknown],errorDescription:JSON.stringify(e)},isSuccess:!1}}))}},3960:function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return u}));var r=t(121),o=t(217);function c(e,n,t){var c=Object(o.a)(n.status);Object(r.s)(e,{isSuccess_1:c,status_2:n.status,errorCode:c?null:JSON.stringify(null==t?void 0:t.error),errorDescription:c?null:JSON.stringify(null==t?void 0:t.errorDescription)})}function u(e,n){var t={lowerBoundSeconds:null,upperBoundSeconds:null};t=e<=0?{lowerBoundSeconds:null,upperBoundSeconds:0}:e<=1?{lowerBoundSeconds:0,upperBoundSeconds:1}:e<=2?{lowerBoundSeconds:1,upperBoundSeconds:2}:e<=5?{lowerBoundSeconds:2,upperBoundSeconds:5}:e<=10?{lowerBoundSeconds:5,upperBoundSeconds:10}:e<=30?{lowerBoundSeconds:10,upperBoundSeconds:30}:e>60?{lowerBoundSeconds:30,upperBoundSeconds:60}:{lowerBoundSeconds:null,upperBoundSeconds:null},Object(r.s)("ConnectedAccounts429Error",{retryAfterLowerBound_1:t.lowerBoundSeconds,retryAfterUpperBound_2:t.upperBoundSeconds,apiName_3:n})}},419:function(e,n,t){"use strict";var r=t(1);function o(e,n){return e?Object(r.a)({mailboxInfo:e},n):null!=n?n:void 0}t.d(n,"a",(function(){return o}))},476:function(e,n,t){"use strict";t.d(n,"a",(function(){return c}));var r=t(57),o=t(24);function c(e){var n=Object(r.i)(e);return n&&n.SessionSettings?0===n.SessionSettings.WebSessionType?Object(o.i)("doc-attachment-routingKeyAadSmtp")?"SMTP:":"":"MSA:":"no-routing-key:"}},575:function(e,n,t){"use strict";t.d(n,"b",(function(){return s})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return d}));var r=t(1),o=t(19),c=t(476),u=t(24),i=t(23);function s(e,n,t){var o,c;if(t)try{for(var u=Object(r.k)(t),i=u.next();!i.done;i=u.next()){var s=i.value;if(!a(e,s))return s}}catch(e){o={error:e}}finally{try{i&&!i.done&&(c=u.return)&&c.call(u)}finally{if(o)throw o.error}}return n&&n.length>0?n[0]:"NoResolvableAddress@invalid.outlook.com"}function a(e,n){return("outlook_"+e+"@outlook.com").toLowerCase()===n.toLowerCase()}function d(){var e=function(){var e=Object(o.a)();if(!e||!e.SessionSettings)return i.d("SessionSettings not available"),"no-routing-key";var n=e.SessionSettings.UserEmailAddress;if(0===e.SessionSettings.WebSessionType)return Object(c.a)()+n;if(Object(u.i)("doc-attachment-routingKeyPuid"))return"PUID:"+e.SessionSettings.UserPuid+"@"+e.SessionSettings.TenantGuid;if(e.SessionSettings.IsShadowMailbox)return Object(c.a)()+e.SessionSettings.LogonEmailAddress;if(a(e.HexCID,e.SessionSettings.UserEmailAddress))return Object(c.a)()+s(e.HexCID,e.SessionSettings.NotManagedEmailAddresses,e.SessionSettings.UserProxyAddresses);return Object(c.a)()+n}();return e=encodeURIComponent(e)}},638:function(e,n,t){"use strict";var r=t(2),o=t(14);n.a=Object(r.createStore)("OWAClientIdStore",{userMailboxInfoMap:new o.ObservableMap})},730:function(e,n,t){"use strict";var r=t(2),o=Object(r.action)("initializeOwaObservableDateTime"),c=Object(r.action)("observableNowChanged"),u=Object(r.action)("observableTodayChanged"),i=t(5),s=t(14),a=Object(r.createStore)("ObservableDateTime",{now:0,today:0}),d=Object(s.computed)((function(){return Object(i.nc)(a().now)})),b=function(){return d.get()},l=Object(s.computed)((function(){return Object(i.nc)(a().today)})),f=function(){return l.get()},O=function(e){return Object(i.Hb)(e,b())},v=function(e){return Object(i.Fb)(e,b())},j=function(e){return S(e,i.Hb)},p=function(e){return S(e,i.Ib)},S=function(e,n){return n(Object(i.Yb)(Object(i.nc)(e)),f())};function A(e){if(!e)return"";var n=Object(i.nc)(e);return function(e,n){var t=Object(i.Yb)(e);if(Object(i.Jb)(t,n))return i.ab;var r=function(e){return Object(i.Ob)(t,Object(i.e)(n,-e),n)};if(r(3))return i.ib;if(r(30))return i.hb;return i.Y}(n,f())(n)}function w(e){if(!e)return"";var n=Object(i.nc)(e);return function(e,n){var t=Object(i.Yb)(e);if(Object(i.Jb)(t,n))return i.T;return i.U}(n,f())(n)}function h(e){return e?function(e,n){var t=Object(i.Yb)(e);return Object(i.Jb)(t,n)?Object(i.ab)(e):y(t,n,2)?Object(i.lb)(e):y(t,n,7)?Object(i.H)(Object(i.bb)(e),Object(i.ab)(e)):Object(i.H)(Object(i.J)(e),Object(i.ab)(e))}(Object(i.nc)(e),f()):""}function y(e,n,t){return Object(i.Ob)(e,Object(i.e)(n,-t),n)}var g=Object(r.action)("updateTimes"),m=Object(r.action)("setNow"),I=Object(r.action)("setToday",(function(e){return{today:e}}));Object(r.mutator)(m,(function(){a().now=Object(i.lc)()})),Object(r.mutator)(I,(function(e){var n=e.today;a().today=n}));var x=t(21),B=t(79),C=!1;Object(r.orchestrator)(o,(function(){if(g(),!C){var e=Object(i.Rb)(),n=Object(i.ac)(Object(i.h)(e,1)),t=Object(i.w)(n,e);setTimeout((function(){return setInterval(g,x.g)}),t),document&&document.addEventListener("visibilitychange",g),C=!0}})),Object(r.orchestrator)(B.l,(function(){g()})),Object(r.orchestrator)(g,(function(){m();var e=Object(i.Ab)(Object(i.mc)()),n=a().today!=e;n&&I(e),c(),n&&u()})),t.d(n,"d",(function(){return o})),t.d(n,"j",(function(){return c})),t.d(n,"l",(function(){return u})),t.d(n,"i",(function(){return b})),t.d(n,"k",(function(){return f})),t.d(n,"g",(function(){return O})),t.d(n,"e",(function(){return v})),t.d(n,"f",(function(){return j})),t.d(n,"h",(function(){return p})),t.d(n,"a",(function(){return A})),t.d(n,"b",(function(){return w})),t.d(n,"c",(function(){return h}))},859:function(e,n,t){"use strict";function r(e){return e>=200&&e<300}t.d(n,"a",(function(){return r}))},868:function(e,n,t){"use strict";t.d(n,"a",(function(){return c}));var r=t(57),o=t(638);function c(e){var n=Object(o.a)().userMailboxInfoMap;if(!n||!n.get(e)){var t=!1;e&&(t=e!=Object(r.b)());var c={type:"UserMailbox",userIdentity:t?e:Object(r.b)(),mailboxSmtpAddress:t?e:Object(r.c)()};return n.set(e,c),c}return n.get(e)}}}]);
//# sourceMappingURL=owa.MailBoot~owa-account-store-init.js.map
self.scriptsLoaded['owa.MailBoot~owa-account-store-init.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~owa-account-store-init.js'] = (new Date()).getTime();