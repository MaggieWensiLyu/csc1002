self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.AddinsCommon.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[346],{1487:function(n,t,e){"use strict";var r=e(1616);function o(n){this.message=n}o.prototype=new Error,o.prototype.name="InvalidTokenError",n.exports=function(n,t){if("string"!=typeof n)throw new o("Invalid token specified");var e=!0===(t=t||{}).header?0:1;try{return JSON.parse(r(n.split(".")[e]))}catch(n){throw new o("Invalid token specified: "+n.message)}},n.exports.InvalidTokenError=o},1616:function(n,t,e){var r=e(1617);n.exports=function(n){var t=n.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(n){return decodeURIComponent(r(n).replace(/(.)/g,(function(n,t){var e=t.charCodeAt(0).toString(16).toUpperCase();return e.length<2&&(e="0"+e),"%"+e})))}(t)}catch(n){return r(t)}}},1617:function(n,t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function r(n){this.message=n}r.prototype=new Error,r.prototype.name="InvalidCharacterError",n.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(n){var t=String(n).replace(/=+$/,"");if(t.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,i,a=0,u=0,c="";i=t.charAt(u++);~i&&(o=a%4?64*o+i:i,a++%4)?c+=String.fromCharCode(255&o>>(-2*a&6)):0)i=e.indexOf(i);return c}},1996:function(n,t,e){"use strict";e.d(t,"a",(function(){return o}));var r=e(2143);function o(n){return Object(r.a)().attachments.get(n.Id)}},2070:function(n,t,e){"use strict";e.d(t,"e",(function(){return d})),e.d(t,"m",(function(){return f})),e.d(t,"i",(function(){return l})),e.d(t,"g",(function(){return s})),e.d(t,"l",(function(){return m})),e.d(t,"k",(function(){return h})),e.d(t,"j",(function(){return p})),e.d(t,"h",(function(){return v})),e.d(t,"f",(function(){return I})),e.d(t,"n",(function(){return w}));var r=e(31),o=e(2113);e.d(t,"o",(function(){return o.a})),e.d(t,"p",(function(){return o.b})),e.d(t,"q",(function(){return o.c}));var i=e(2143);e.d(t,"b",(function(){return i.a}));var a=e(2214);e.d(t,"d",(function(){return a.a})),e.d(t,"c",(function(){return a.b}));var u=e(2230);e.d(t,"a",(function(){return u.a}));var c=new r.c((function(){return Promise.all([e.e(4),e.e(21),e.e(42),e.e(77),e.e(539),e.e(352)]).then(e.bind(null,3605))})),d=new r.a(c,(function(n){return n.addAndInitializeAttachments})),f=new r.a(c,(function(n){return n.setPreviewImageUrl})),l=new r.a(c,(function(n){return n.refreshDownloadUrl})),s=new r.a(c,(function(n){return n.createAttachmentInfo})),m=new r.a(c,(function(n){return n.setAttachmentInfo})),h=new r.a(c,(function(n){return n.refreshThumbnailImageUrl})),p=new r.a(c,(function(n){return n.refreshPreviewImageUrl})),v=new r.b(c,(function(n){return n.getAttachment})),I=new r.b(c,(function(n){return n.checkPendingAttachmentOperation})),w=new r.b(c,(function(n){return n.shouldShowImageView}))},2113:function(n,t,e){"use strict";e.d(t,"a",(function(){return o})),e.d(t,"b",(function(){return i})),e.d(t,"c",(function(){return a}));var r=e(2),o=Object(r.action)("REFRESH_SHARING_TIPS_FOR_ATTACHMENT",(function(n){return{attachmentId:n}})),i=Object(r.action)("SET_ATTACHMENT_CONTENTID",(function(n,t){return{attachmentId:n,attachmentContentId:t}})),a=Object(r.action)("SET_ATTACHMENT_ISINLINE",(function(n,t){return{attachmentId:n,isInline:t}}))},2212:function(n,t,e){"use strict";var r=e(2060),o=e(6),i=function(n){return n&&["IPM.Note","IPM.Schedule.Meeting","IPM.GroupMailbox.JoinRequest","IPM.Post"].includes(n)};function a(n){var t=n.__type||n.OwsTypeName;switch(t){case r.a:return 0;case r.e:return n.IsLink?3:1;case r.d:return 3;case r.b:return 2;case r.c:var e=n,a=n.EmbeddedItemClass;return a&&i(a)||Object(o.f)(e.AttachmentIdToAttach)?2:0;default:throw new Error("Invalid type of attachment "+t)}}e.d(t,"a",(function(){return a}))},2214:function(n,t,e){"use strict";function r(n){return(null==n?void 0:n.AttachmentId)&&o(n.AttachmentId.Id)}function o(n){return n&&-1!==n.indexOf("smime-")}e.d(t,"a",(function(){return r})),e.d(t,"b",(function(){return o}))},2230:function(n,t,e){"use strict";e.d(t,"b",(function(){return r})),e.d(t,"c",(function(){return o})),e.d(t,"d",(function(){return i})),e.d(t,"e",(function(){return a})),e.d(t,"f",(function(){return u})),e.d(t,"g",(function(){return c})),e.d(t,"h",(function(){return d})),e.d(t,"i",(function(){return f})),e.d(t,"j",(function(){return l})),e.d(t,"k",(function(){return s})),e.d(t,"l",(function(){return m})),e.d(t,"a",(function(){return h}));var r="Box",o="Dropbox",i="Facebook",a="GDrive",u="Mailbox",c="MailMessage",d="OneDriveConsumer",f="OneDrivePro",l="WopiBox",s="WopiDropbox",m="WopiEgnyte",h={providers:{BOX:r,DROPBOX:o,FACEBOOK:i,GDRIVE:a,MAILBOX:u,ONE_DRIVE_CONSUMER:d,ONE_DRIVE_PRO:f,RECENT_ATTACHMENTS:"RecentAttachments",WOPI:"Wopi",WOPI_BOX:l,WOPI_EGNYTE:m}}},2359:function(n,t,e){"use strict";e.d(t,"a",(function(){return o})),e.d(t,"b",(function(){return i}));var r=e(2212);function o(n){return a(n.type)}function i(n){return a(Object(r.a)(n))}function a(n){return 1===n||3===n}},4020:function(n,t,e){"use strict";var r,o,i=e(1),a=32,u=126;function c(n){var t,e;if(!n)return!1;try{for(var r=Object(i.k)(n),o=r.next();!o.done;o=r.next()){var c=o.value;if(null==c||0===c.trim().length)return!1;for(var d=c.length;d--;)if(c.charCodeAt(d)>u||c.charCodeAt(d)<a)return!1}}catch(n){t={error:n}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return!0}function d(n){return!!n&&c(Object.keys(n))}!function(n){n[n.Read=1]="Read",n[n.Create=2]="Create",n[n.DeleteOwn=4]="DeleteOwn",n[n.DeleteAll=8]="DeleteAll",n[n.EditOwn=16]="EditOwn",n[n.EditAll=32]="EditAll"}(r||(r={})),function(n){n.Base64="base64",n.Eml="eml",n.Url="url",n.Ical="iCalendar"}(o||(o={}));var f=e(3482),l=(e(3483),e(3331)),s=e(3481),m=function(n){var t={locationIdentifier:{}};return t.displayName=n.DisplayName,n.PostalAddress&&"Resource"===n.PostalAddress.LocationSource?(t.emailAddress=n.PostalAddress.LocationUri,t.locationIdentifier.id=t.emailAddress,t.locationIdentifier.type=f.a.Room):(t.emailAddress="",t.locationIdentifier.id=t.displayName,t.locationIdentifier.type=f.a.Custom),t};function h(n){var t,e;if(!n||n.length<=0)return!1;try{for(var r=Object(i.k)(n),o=r.next();!o.done;o=r.next()){if(o.value.id.trim().length<=0)return!1}}catch(n){t={error:n}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return!0}e.d(t,"i",(function(){return c})),e.d(t,"h",(function(){return d})),e.d(t,"d",(function(){return r})),e.d(t,"b",(function(){return o})),e.d(t,"e",(function(){return f.a})),e.d(t,"a",(function(){return l.a})),e.d(t,"f",(function(){return l.b})),e.d(t,"c",(function(){return s.a})),e.d(t,"g",(function(){return m})),e.d(t,"j",(function(){return h}))},4607:function(n,t,e){"use strict";e.d(t,"a",(function(){return o}));var r=e(2060);function o(n){return(n.__type||n.OwsTypeName)===r.b}},4866:function(n,t,e){"use strict";e.d(t,"a",(function(){return o}));var r=e(2060);function o(n){return(n.__type||n.OwsTypeName)===r.a}},5386:function(n,t,e){"use strict";e.r(t);var r,o=e(1996),i=e(2359),a=e(4866),u=e(2110),c=e(4607);function d(n){var t=[];return n&&(n.inlineAttachments&&n.inlineAttachments.forEach((function(n){var e=l(n);t.push(e)})),n.docViewAttachments&&n.docViewAttachments.forEach((function(n){var e=l(n);t.push(e)})),n.imageViewAttachments&&n.imageViewAttachments.forEach((function(n){var e=l(n);t.push(e)}))),t}function f(n){if(Object(a.a)(n))return r.File;if(Object(c.a)(n))return r.Item;if(Object(u.a)(n))return r.Cloud;throw new Error("Invalid type of attachment "+(null==n?void 0:n.__type))}function l(n){var t=void 0,e=Object(o.a)(n.attachmentId);if(null==e?void 0:e.model){Object(i.b)(e.model)&&(t=e.model.AttachLongPathName);var r={id:n.attachmentId.Id,name:e.model.Name,contentType:e.model.ContentType,size:e.model.Size,attachmentType:f(e.model),isInline:e.model.IsInline,url:t}}return r}!function(n){n[n.File=0]="File",n[n.Item=1]="Item",n[n.Cloud=2]="Cloud"}(r||(r={}));var s,m=e(1),h=e(3177),p=e(4020),v=e(94),I=e(2070),w=e(5),b=e(1487),O=e.n(b),g="IPM.Note";function A(n,t){return Object(m.c)(this,void 0,void 0,(function(){var t,e,r,i,a,u,c,d,f,l;return Object(m.f)(this,(function(m){switch(m.label){case 0:return t=null,e=null,null,r=null,i={content:"",format:s.Base64},a=Object(o.a)(n.attachmentId),[4,h.c.importAndExecute(a.model)];case 1:return u=m.sent(),function(n){var t=new URLSearchParams(n).get("token"),e=O()(t),r=1e3*parseInt(e.exp),o=Object(w.Rb)();if(r<o)return!0;return!1}(a.download.url)?[4,I.i.importAndExecute(n.attachmentId,!0,!0)]:[3,3];case 2:m.sent(),m.label=3;case 3:return u!==p.a.Item?[3,6]:(t=a.download.url,[4,fetch(t)]);case 4:return[4,m.sent().text()];case 5:return r=m.sent(),c=a.model.EmbeddedItemClass||g,i.format="IPM.Note"===c?s.Eml:s.Ical,i.content=r,[3,11];case 6:return u!==p.a.Cloud?[3,7]:(t=a.download.url,d=new URLSearchParams(t),f=d.get("location"),l=decodeURIComponent(f),i.format=s.Url,i.content=l,[3,11]);case 7:return u!==p.a.File?[3,10]:(t=a.download.url+"&asDataUri=true",[4,fetch(t)]);case 8:return[4,m.sent().text()];case 9:return r=m.sent(),e=r.substr(r.indexOf(",")+1),e=(b=e)?b.replace(/\s+/g,""):b,i.format=s.Base64,i.content=e,[3,11];case 10:Object(v.a)(u),m.label=11;case 11:return[2,i]}var b}))}))}!function(n){n.Base64="base64",n.Eml="eml",n.Url="url",n.Ical="iCalendar"}(s||(s={}));var E=e(2018),y=e(2063),C=new Map,T=!1;function N(n,t){T||(window.addEventListener("message",(function(n){return function(n){var t=j(n);if(!t)return;var e=C.get(t),r=null==e?void 0:e.childWindow,o=null==e?void 0:e.addinFrameId;if(r&&o&&n.source===r.opener){var i=r.document.getElementById(o);i&&i.contentWindow.postMessage(n.data,i.src)}}(n)})),T=!0),n.addEventListener("message",(function(t){return function(n,t){var e=j(t);if(!e)return;if(!C.get(e))for(var r=n.document.getElementsByTagName("iframe"),o=0;o<r.length;o++)if(r[o].contentWindow===t.source){C.set(e,{childWindow:n,addinFrameId:r[o].id});break}n.opener.postMessage(t.data,n.opener.location.href)}(n,t)})),n.addEventListener("beforeunload",(function(){return function(n,t){E.x.import().then((function(e){return e(t,n)}))}(n,t)})),"Compose"===Object(y.A)(t)&&Object(y.pb)("exfc_main")}function j(n){try{return JSON.parse(n.data)._conversationId}catch(n){return}}e.d(t,"getAllAttachments",(function(){return d})),e.d(t,"getAttachmentContentHelper",(function(){return A})),e.d(t,"getTypeOfAttachment",(function(){return f})),e.d(t,"prepareAddinCommunicationInPopout",(function(){return N}))}}]);
//# sourceMappingURL=owa.AddinsCommon.js.map
self.scriptsLoaded['owa.AddinsCommon.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.AddinsCommon.js'] = (new Date()).getTime();